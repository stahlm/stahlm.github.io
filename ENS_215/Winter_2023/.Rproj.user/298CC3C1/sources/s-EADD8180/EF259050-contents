---
title: 'Lab 2: Global Dams Data'
author: "Patrick Mulready"
output:
  html_document:
    df_print: paged
---
## Introduction 

##### Dam use is one of the most controversial topics in modern environmentalism. On one hand, dams can provide flood protection, drought resistance, and hydroelectricity to local communities, but on the other hand, they disrupt river ecosystems and increase emissions. Careful study is necessary to determine the net benefit or harm of dams around the world. Luckily, extensive surveying and research has been done to compile a research quality dataset with information on dams around the world. Today I will be working with that dataset in R to draw some conclusions about dam use. 

## Required

```{r}
library(tidyverse) #loading the tidyverse package
```

```{r}
dams_data <- read_csv("https://stahlm.github.io/ENS_215/Data/Dams_FAO_SelectCols_LabData.csv") #downloading the dam data
```
```{r}
dams_data <- arrange(dams_data, Country, Dam_name) #arranging the data alphabetically by country, then dam name for my own preference
```

```{r}
summary(dams_data) #getting a summary of the data
```
##### Just looking at this summary, we can already make some conclusions about the data at hand. There are 14,216 observations in the dataset with information from dams built from 2013 all the way back to the year 1000 (assuming that is not an incorrect number). The tallest dam is 712 meters, while the shortest is only 0.71 meters! The numbers 0 and 1 are used to indicate whether a dam is used for a specific purpose, such as irrigation, water supply, and more. It is difficult to make any conclusions looking at the numbers right now, but further analysis of these figures could reveal what uses are most and least common. 

```{r}
ggplot(data = dams_data) + 
  geom_point(aes(x = Reservoir_capacity_million_m3, y = Reservoir_area_km2)) #creating a scatter plot showing the relationship between reservoir storage and storage area
```
##### Because there are some extreme outliers, the graph above is not very helpful as most of the distinctions between the data happen at low values, which all get mixed together. To remedy this, I will add a logarithmic scale to make it more readable. 

```{r}
ggplot(data = dams_data) + 
  geom_point(aes(x = Reservoir_capacity_million_m3, y = Reservoir_area_km2)) +

scale_x_log10() +
scale_y_log10() 
```
##### This graph shows a much clearer relationship between an increase in reservoir area and an increase in reservoir capacity. To illuminate the information even further, we can color it by continent and facet wrap it to see the graphs separately. 

```{r}
ggplot(data = dams_data) + 
  geom_point(aes(x = Reservoir_capacity_million_m3, y = Reservoir_area_km2, color = Continent)) +

scale_x_log10() +
scale_y_log10() + 
  facet_wrap(~ Continent)
```
##### By doing this, we can see that Europe and Oceania mostly have dams with a larger area and capacity, while Asia and the Americas have a large spread of both large and small dams.   

##### Next I will create a scatter plot showing the relationshop between reservoir storage and dam height, once again using a logarithmic scale to make it more readable

```{r}
ggplot(data = dams_data) + 
  geom_point(aes(x = Reservoir_capacity_million_m3, y = Dam_height_m)) +

scale_x_log10() +
scale_y_log10()
```
##### Once again, we can see an obvious correlation between an increased capacity with increased dam height, but using `facet_wrap()` will allow for more specific analysis. 

```{r}
ggplot(data = dams_data) + 
  geom_point(aes(x = Reservoir_capacity_million_m3, y = Dam_height_m, color = Continent)) +

scale_x_log10() +
scale_y_log10() + 
  facet_wrap(~ Continent)
```
##### These graphs offer an interesting insight. These graphs are more "blob shaped", which I say to mean that there is less of a linear relationship between dam height and capacity. This means that it is not uncommon to find a high dam with relatively low capacity and vice versa. The reservoir area to capacity relationship is much more strict.   


##### Next I will calculate the average height, area, and storage capacity for the dams and display these figures. 
```{r}
mean(dams_data$Dam_height_m, na.rm = TRUE)
mean(dams_data$Reservoir_area_km2, na.rm = TRUE)
mean(dams_data$Reservoir_capacity_million_m3, na.rm = TRUE) #the na.rm specifies to remove "no answer" observations
```
##### These figures are interesting, but it may be more helpful to get the averages for each continent to compare them, which I will do using the `group_by()` and `summarize()` functions. 

```{r}
dams_data %>% 
  group_by(Continent) %>% 
  summarize(mean_height = mean(Dam_height_m, na.rm = T), 
            mean_area = mean(Reservoir_area_km2, na.rm = T), 
            mean_storage = mean(Reservoir_capacity_million_m3, na.rm = T))
```
##### Now we can start to make some conclusions. On average, dams in Europe and Oceania are much taller than those in Africa, Asia, or the Americas. Perhaps more dams are built in mountainous regions in those continents. It is not known. The average area of reservoirs is vastly higher in Africa compared to other continents. Perhaps dams in Africa are built in less mountainous environments and have more space to spread out over a large area. Finally, the continents with the largest mean storage are Europe and Africa, which is concurrent with the other data because of the height in Europe and the area in Africa. Further analysis would be necessary to discover the root of these figures, but they provide a good starting point for asking questions. 

##### I will now create a box plot comparing reservoir storage capacities between continents. 

```{r}
ggplot(data = dams_data) + 
  geom_boxplot(aes(x = Continent, y = Reservoir_capacity_million_m3)) +

scale_y_log10() 
```
##### This data is concurrent with what we have seen before. Asia and the Americas have a large spread, while Europe and Oceania are on the larger side. 

## Additional analysis 

##### I am curious to see whether the size of dams has increased over time. I will make a plot of the reservoir capacity over the year. 

```{r}
ggplot(data = dams_data) + 
  geom_point(aes(x = Year_completed, y = Dam_height_m, alpha = 1)) + #adding an alpha value for readability

scale_y_log10() +
  xlim(1825, NA) #adding an x limit for clarity 
```
##### This is a very dense plot, but there are still conclusions that can be drawn from it. First, there is not necessarily a linear relationship of dam height increasing over time. Rather, it appears as though the range of dam heights is expanded, expecially the upper limit. We can also see large increases in dam production around 1905 and 1945. There are also some artifacts on this graph, straight lines between 3 and 10 meters that indicate many dams being built at that specific height.  


##### While working, I found myself wondering which country in the world has the most dams. Rather than Googling it, I tried to see if I could figure it out in R using the `count()` function and then arranging the data in descending order. 

```{r}
count(dams_data, Country) %>% arrange(desc(n))
```
##### We can see that India has the most dams in the world by far with over 3,000. The United States is second at nearly 2,000, which is much more than all of the other countries. I would like to compare these two "dam giants". I will first create a data table with only the data from these two countries. 

```{r}
dam_giants <- filter(dams_data, Country == "India" | Country == "United States of America")
```

##### Using the `dam_giants` data frame will allow me to make graphs without having to specify the countries India and United States over and over again. Next, I will make a graph comparing the sizes of dams in the two countries, graphing dam height over reservoir capacity. 

```{r}
ggplot(data = dam_giants) + 
  geom_point(aes(x = Reservoir_capacity_million_m3, y = Dam_height_m, color = Country)) +

scale_x_log10() +
scale_y_log10() + 
  facet_wrap(~ Country)
```
##### This graph contains some interesting artifacts. First, the height of dams in India appears to be generally higher than those in the United States, as India has almost no dams shorter than 10 meters, while the United States has many of these small dams. Conversely, the capacity of U.S. dams is much higher, as there are no dams built with a capacity less than 10 million cubic meters, while in India there is more variation in the capacity. Both countries show a general trend of greater height corresponding to greater capacity.   

##### Next, I will try to use the `count()` function to determine the prevalent use for dams in the U.S. and India. 

```{r}
count(dam_giants, Country, Water_supply) 
```

##### Viewing the data in this way is helpful, but it would be better to visualize it, so I will make a graph, and while I'm at it, I will graph all of the different dam use variables. 

```{r}
ggplot(data = dam_giants) + 
  geom_bar(aes(x = Water_supply, fill = Country))

ggplot(data = dam_giants) + 
  geom_bar(aes(x = Flood_control, fill = Country))

ggplot(data = dam_giants) + 
  geom_bar(aes(x = Hydroelectricity, fill = Country))

ggplot(data = dam_giants) + 
  geom_bar(aes(x = Navigation, fill = Country))

ggplot(data = dam_giants) + 
  geom_bar(aes(x = Recreation, fill = Country))

ggplot(data = dam_giants) + 
  geom_bar(aes(x = Pollution_control, fill = Country))

ggplot(data = dam_giants) + 
  geom_bar(aes(x = Livestock_rearing, fill = Country))

ggplot(data = dam_giants) + 
  geom_bar(aes(x = Other, fill = Country))
```
##### I realize that this is incredibly inefficient. I wanted to get all of the information on one graph, but after trying different methods for a full hour, I decided that clicking through the different graphs would have to do. After looking at this data, I realized that the dam use variables could not be relied on for comparison because the United States has more observations in every category, including "Other", even though India has a larger total number of dams. This means that the dam use variables must be underreported in India, and thus cannot be used for comparison. This is a wholly unsuccessful graph, but I will attempt to continue increasing my knowledge of R so I may be able to execute what I envisioned. I was able to analyze this data set even with my rudimentary knowledge of R, but further analysis would have to be done to make definitive conclusions and policy recommendations. 