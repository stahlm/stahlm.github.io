---
title: 'Lab 1: EPA Fuel Efficiency Analysis'
author: "Sebastian Graber-Adamsons"
output:
  html_document:
    df_print: paged
---

```{r}
library(tidyverse)
library(ggstats)
library(ggstatsplot)
library(corrplot)
library(correlation)
```

```{r}
fuel_data <- mpg # assigning mpg to a new object
```

```{r}
str(fuel_data) 
```

Number of rows appears to be 234, with 11 columns or categories

```{r}
head(fuel_data)
tail(fuel_data)
```

Disp likely stands for displacement or size, Cyl likely stands for cylinders, cty likely stands for city mpg (city vs highway) Disp actually is engine displacement, everything else is correct data obtained from fueleconomy.gov

```{r}
n_rows <- nrow(fuel_data)
n_rows
n_col <- ncol(fuel_data)
n_col
```

234 rows, 11 columns

```{r}
summary(fuel_data)
```

most fuel efficient vehicle on the highway gets 44mpg, least efficient is 12mpg average mpg for city driving is 16.86mpg

```{r}
fuel_data <- mutate(fuel_data, hwy2cty = hwy/cty)
fuel_data$hwy2cty <- fuel_data$hwy/fuel_data$cty
```

```{r}
summary(fuel_data)
```

No vehicles get better range in the city than on the highway, and no vehicles get twice the performance on the highway. The most extreme ratio is 1.667

```{r}
ggplot(data = fuel_data) +
  geom_point(aes(x = displ, y = hwy))
```

It appears that displ and hwy are inversely correlated, however we are not able to say that one leads to another, as there could be other factors involved, such as vehicle size (class)

```{r}
ggplot(data = fuel_data) +
  geom_point(aes(x = displ, y = hwy, color = class))
```

Similar to how I predicted previously, vehicle class and weight may play a larger role than engine displacement in in determining fuel efficiency. As you can see in the graphic above, compact and subcompact cars have some of the better fuel efficiency, with smaller engines, while larger vehicles such as midsizes and minivans have worse fuel efficiency and higher displacement.

```{r}
us_makes <- c("chevrolet","dodge", "ford", "jeep", "lincoln", "mercury", "pontiac")
fuel_data <- mutate(fuel_data, region = if_else(manufacturer %in% us_makes, "US", "Foreign"))
fuel_data
```

Do US Cars have lower mpg? and if so, is this difference significant?

```{r}
ggplot(data = fuel_data) +
  geom_point(aes(x = hwy, y = displ, color = region))
```

Create weight category based on class

```{r}
fuel_data <- mutate(fuel_data, class = factor(class, ordered = TRUE, levels = c("2seater", "subcompact", "compact", "midsize", "suv", "minivan", "pickup")))
```

US Cars:

```{r}
us_car <- fuel_data[fuel_data$region == "US",]
us_car
summary(us_car)
```

```{r}
us_fe <- us_car[,9]
us_fe
```

```{r}
for_car <- fuel_data[fuel_data$region == "Foreign",]
for_car
summary(for_car)
```

```{r}
for_fe <- for_car[,9]
for_fe
```

```{r}
t.test(for_fe,us_fe)
```

```{r}
t.test(for_car$hwy,us_car$hwy)
```

```{r}
fuel_data %>% 
  group_by(class) %>% 
  summarize(mean_hwy = mean(hwy),
            mean_cty = mean(cty),
            mean_mpg = ((mean(cty)+mean(hwy))/2),
            mean_displ = mean(displ)
            )
ggplot(data = fuel_data) +
  geom_point(aes(x = class, y = hwy, color = region))
```

```{r}
ggplot(data = mpg) + 
  geom_point(mapping = aes(x = displ, y = hwy, color=class)) +
  facet_wrap(~ class, nrow = 2)
```

```{r}
mean_for_car = mean(for_car$hwy)
mean_for_car
mean_us_car = mean(us_car$hwy)
mean_us_car
```

```{r}
model <- lm(fuel_data$hwy ~ fuel_data$displ)
model
# This does not work
## world_fe <- list(fuel_data$hwy)
## library(ggplot2)
## ggplot() +
##  geom_point(aes(x=fuel_data$displ, y=fuel_data$hwy), color = "red") +
##  geom_line(aes(x=fuel_data$displ, y=(predict(model, newdata = world_fe)), color = "blue")) +
##  ggtitle('FE vs DISP') +
##  xlab('engine displacement')+ylab('fuel economy')
```

For this exercise, my goal was to try and find out if American made cars were less fuel efficient than foreign cars, and figure out a reason for that discrepancy should it exist. As I predicted, American cars have the lowest miles per gallon in every single vehicle class that has foreign competition, as seen in the figure run by code starting on line 99. One possible reason for this is that two classes of vehicle, 2-seater and SUV, are not produced by foreign companies in this data set, which could skew the data a little. However, even when looking at just the classes of vehicle where american and foreign brands compete, it is evident that there is a strong correlation between a vehicle's manufacturing origin and its fuel efficiency, or lack thereof. To test this, I preformed a two sample T-Test, which revealed that the correlation between maker and highway MPG was strong, with a an extremely significant p-value of under 2.2e-16. Next, I ran a regression of highway mpg on displacement, which revealed a negative correlation between engine displacement and fuel efficiency, meaning that for every 1L increase in displacement, highway mpg would decrease by 3.531 on average. From this information, I was able to deduce that cars in the United States are on average less fuel efficient, likely due to higher engine displacement and the larger size of vehicles. In the future, I would love to return to explore this topic once I have learned more about R and am more comfortable with its data analysis toolsets.
