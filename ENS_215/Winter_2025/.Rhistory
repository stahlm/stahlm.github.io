filter(n_samples >= 250)
sites2plot <- site_summary %>%
filter(n_samples >= 210)
sites2plot <- site_summary %>%
filter(n_samples >= 220)
sites2plot <- site_summary %>%
filter(n_samples >= 225)
sites2plot <- site_summary %>%
filter(n_samples >= 230)
data_Na_Cl %>%
filter(MonitoringLocationIdentifier %in% sites2plot$MonitoringLocationIdentifier) %>%
ggplot(aes(x = ActivityStartDate, y = ResultMeasureValue_Na, group = MonitoringLocationIdentifier)) +
geom_point() +
geom_line() +
facet_wrap(~MonitoringLocationIdentifier)
library(tidyverse)
library(lubridate)
library(tmap)
library(sf)
library(climateR)
library(AOI)
library(spData)
library(dygraphs)
library(xts)
raster_tc_ppt <- climateR::dap(
URL= "http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_ppt_1958_CurrentYear_GLOBE.nc",
catalog = NULL,
AOI = my_aoi,
grid = NULL,
varname = NULL,
endDate = "2023-01-01",
startDate =  "2022-05-01",
toptobottom = FALSE,
verbose = TRUE
)
my_aoi <- AOI::aoi_get(county = "Ulster", state = "NY")
raster_tc_ppt <- climateR::dap(
URL= "http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_ppt_1958_CurrentYear_GLOBE.nc",
catalog = NULL,
AOI = my_aoi,
grid = NULL,
varname = NULL,
endDate = "2023-01-01",
startDate =  "2022-05-01",
toptobottom = FALSE,
verbose = TRUE
)
terra::plot(raster_tc_ppt)
terra::plot(raster_tc_ppt$ppt)
raster_tc_ppt <- climateR::dap(
URL= "http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_ppt_1958_CurrentYear_GLOBE.nc",
catalog = NULL,
AOI = my_aoi,
grid = NULL,
varname = NULL,
endDate = "2024-05-01",
startDate =  "2023-05-01",
toptobottom = FALSE,
verbose = TRUE
)
a <- params
a <- catalog
View(a)
library(RNetCDF)
lat.range=c(-40,-44)        #! Ranges instead of point values. Order does not matter
lon.range=c(140,150)
baseurlagg <- paste0(paste0("http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_",var),"_1958_CurrentYear_GLOBE.nc")
var="ppt"
baseurlagg <- paste0(paste0("http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_",var),"_1958_CurrentYear_GLOBE.nc")
nc <- open.nc(baseurlagg)
lon <- var.get.nc(nc, "lon")
lat <- var.get.nc(nc, "lat")
lat.range <- sort(lat.range)                              #!sort user input values from low to high
lon.range <-sort(lon.range)
lat.index <- which(lat>=lat.range[1]&lat<=lat.range[2])    #! index values within specified range
lon.index <- which(lon>=lon.range[1]&lon<=lon.range[2])
lat.n <- length(lat.index)                                #!value for count
lon.n <- length(lon.index)
start <- c(lon.index[1], lat.index[1], 1)
count <- c(lon.n, lat.n, NA)
data <-var.get.nc(nc, variable = var,start = start, count,unpack=TRUE)
data
r_LCMAP <- getLCMAP(my_aoi, year = 2019, type = "primary landcover", ID = NULL)
terra::plot(r_LCMAP)
r_LCMAP
a <- read_live_catalog()
install.packages("tippy")
library(tippy)
library(tidyverse)
precip_data <- read_csv("https://stahlm.github.io/ENS_215/Data/NOAA_State_Precip_LabData.csv")
ny_precip <- filter(precip_data, state_cd == "NY")
# Your code here
ny_precip <- ny_precip %>%
mutate(time_period = if_else(Year >= 1950,"Post-1950","Pre-1950"))
quantile(ny_precip$Precip_inches, probs = c(0.001, 0.25, 0.50, 0.75, 0.95))
ny_precip %>%
mutate(frac = round(cume_dist(Precip_inches), 2))
#arrange(Precip_inches) %>%
#mutate(quant = (seq(1,nrow(ny_precip)) - 0.5)/nrow(ny_precip))
ny_precip %>%
mutate(frac = round(cume_dist(Precip_inches), 3))
#arrange(Precip_inches) %>%
#mutate(quant = (seq(1,nrow(ny_precip)) - 0.5)/nrow(ny_precip))
ny_precip %>%
ggplot(aes(x = state_cd, y = Precip_inches)) +
geom_boxplot(fill = "grey") +
labs(y = "Precip (inches)",
x = ""
) +
theme_classic()
ny_precip %>%
ggplot(aes(x = state_cd, y = Precip_inches)) +
geom_boxplot(fill = "grey") +
labs(y = "Precip (inches)",
x = ""
) +
theme_classic()
ny_precip %>%
ggplot(aes(x = state_cd, y = Precip_inches)) +
geom_boxplot(fill = "grey") +
geom_jitter(alpha = 0.1, width = 0.15, height = 0) +
labs(y = "Precip (inches)",
x = ""
) +
theme_classic()
ny_precip %>%
ggplot(aes(x = time_period, y = Precip_inches)) +
geom_boxplot(fill = "grey", notch = TRUE) +
labs(y = "Precip (inches)",
x = ""
) +
theme_classic()
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 )) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red") +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue") +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 ), size = 1) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red") +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue") +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 ), size = 1.5) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red") +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue") +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 ), size = 2) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red") +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue") +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 ), size = 2) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red", size = 2) +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue", size = 2) +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
library(tidyverse)
library(stats)
library(ggridges)
precip_data <- read_csv("https://stahlm.github.io/ENS_215/Data/NOAA_State_Precip_LabData.csv")
precip_data <- precip_data %>%
mutate(time_period = if_else(Year >= 1950,"Post-1950","Pre-1950"))
ny_precip <- precip_data %>%
filter(state_cd == "NY")
ny_precip %>%
ggplot(aes(Precip_inches)) +
geom_histogram() +
theme_classic()
ny_precip %>%
ggplot(aes(Precip_inches, stat(density))) +
geom_histogram() +
theme_classic()
library(tidyverse)
df_lichen <- read_csv("./air_lichen_queryFull.csv")
View(df_lichen)
df_lichen <- df_lichen %>%
mutate(across(contains(" dw")), as.numeric)
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), , as.numeric))
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric))
library(tidyverse)
df_lichen <- read_csv("./air_lichen_queryFull.csv")
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric))
View(df_lichen)
df_lichen <- read_csv("./air_lichen_queryFull.csv")
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric))
df_lichen <- read_csv("./air_lichen_queryFull.csv")
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric))
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric)) %>%
mutate(`Distance from coast (miles)` = as.numeric(`Distance from coast (miles)`),
`Precipitation (cm/yr)` = as.numeric(`Precipitation (cm/yr)`)
)
library(tidyverse)
library(lubridate)
library(leaflet)
library(sf)
library(tmap)
library(dataRetrieval)
start_date <- "1995-01-01"
pCode <- c("00940")
sites_Cl <- whatWQPdata(stateCd = "NH",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
pCode <- c("00940")
sites_Cl <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
View(sites_Cl)
pCode <- c("00618")
sites_NO3 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
library(tidyverse)
library(lubridate)
library(leaflet)
library(sf)
library(tmap)
library(dataRetrieval)
start_date <- "1995-01-01"
pCode <- c("00618")
sites_NO3 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
data_NO3 <- readWQPqw(siteNumbers = sites_NO3$MonitoringLocationIdentifier,
parameterCd = pCode,
startDate = start_date
)
View(data_NO3)
pCode <- c("00653")
sites_PO4 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
pCode <- c("00650")
sites_PO4 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
pCode <- c("00666")
sites_PO4 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
pCode <- c("00673")
sites_PO4 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
pCode <- c("00666")
sites_PO4 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
data_PO4 <- readWQPqw(siteNumbers = sites_PO4$MonitoringLocationIdentifier,
parameterCd = pCode,
startDate = start_date
)
data_select_NO3 <- data_NO3 %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_Cl = CharacteristicName,
USGSPCode_Cl = USGSPCode,
ResultMeasureValue_Cl = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_Cl = ResultMeasure.MeasureUnitCode)
data_select_NO3 <- data_NO3 %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_NO3 = CharacteristicName,
USGSPCode_NO3 = USGSPCode,
ResultMeasureValue_NO3 = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_NO3 = ResultMeasure.MeasureUnitCode)
data_select_NO3 <- data_select_NO3 %>%
group_by(ActivityStartDate, MonitoringLocationIdentifier) %>%
summarize(CharacteristicName_NO3 = first(CharacteristicName_NO3),
USGSPCode_NO3 = first(USGSPCode_NO3),
ResultMeasureValue_NO3 = mean(ResultMeasureValue_NO3, na.rm = T),
ResultMeasure_MeasureUnitCode_NO3 = first(ResultMeasure_MeasureUnitCode_NO3)
)
View(data_select_NO3)
data_select_PO4 <- data_PO4 %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_PO4 = CharacteristicName,
USGSPCode_PO4 = USGSPCode,
ResultMeasureValue_PO4 = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_PO4 = ResultMeasure.MeasureUnitCode)
data_select_PO4 <- data_select_PO4 %>%
group_by(ActivityStartDate, MonitoringLocationIdentifier) %>%
summarize(CharacteristicName_PO4 = first(CharacteristicName_PO4),
USGSPCode_Na = first(USGSPCode_Na),
ResultMeasureValue_PO4 = mean(ResultMeasureValue_Na, na.rm = T),
ResultMeasure_MeasureUnitCode_PO4 = first(ResultMeasure_MeasureUnitCode_PO4)
)
data_select_PO4 <- data_select_PO4 %>%
group_by(ActivityStartDate, MonitoringLocationIdentifier) %>%
summarize(CharacteristicName_PO4 = first(CharacteristicName_PO4),
USGSPCode_PO4 = first(USGSPCode_PO4),
ResultMeasureValue_PO4 = mean(ResultMeasureValue_PO4, na.rm = T),
ResultMeasure_MeasureUnitCode_PO4 = first(ResultMeasure_MeasureUnitCode_PO4)
)
data_NO3_PO4 <- data_select_NO3 %>%
full_join(data_select_PO4)
site_info_select <- sites_NO3 %>%
bind_rows(sites_PO4) %>%
distinct()
site_info_select <- site_info_select %>%
select(MonitoringLocationIdentifier,
MonitoringLocationName,
HUCEightDigitCode,
ResolvedMonitoringLocationTypeName,
StateName,
CountyName,
lat,
lon) %>%
distinct()
data_NO3_PO4 <- data_NO3_PO4 %>%
left_join(site_info_select)
write_csv(x = data_Na_Cl, file = "./data_NO3_PO4.csv")
write_csv(x = data_NO3_PO4, file = "./data_NO3_PO4.csv")
data_NO3_PO4 %>%
ggplot(aes(x = ResultMeasureValue_PO4, y = ResultMeasureValue_NO3)) +
geom_point()
site_summary <- data_NO3_PO4 %>%
group_by(MonitoringLocationIdentifier) %>%
summarize(n_samples = n())
View(site_summary)
View(data_NO3_PO4)
start_date <- "1970-01-01"
start_date <- "1970-01-01"
pCode <- c("00618")
sites_NO3 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
data_NO3 <- readWQPqw(siteNumbers = sites_NO3$MonitoringLocationIdentifier,
parameterCd = pCode,
startDate = start_date
)
View(data_NO3)
pCode <- c("00666")
sites_PO4 <- whatWQPdata(stateCd = "NY",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Lake, Reservoir, Impoundment"))
data_PO4 <- readWQPqw(siteNumbers = sites_PO4$MonitoringLocationIdentifier,
parameterCd = pCode,
startDate = start_date
)
data_select_NO3 <- data_NO3 %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_NO3 = CharacteristicName,
USGSPCode_NO3 = USGSPCode,
ResultMeasureValue_NO3 = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_NO3 = ResultMeasure.MeasureUnitCode)
data_select_NO3 <- data_select_NO3 %>%
group_by(ActivityStartDate, MonitoringLocationIdentifier) %>%
summarize(CharacteristicName_NO3 = first(CharacteristicName_NO3),
USGSPCode_NO3 = first(USGSPCode_NO3),
ResultMeasureValue_NO3 = mean(ResultMeasureValue_NO3, na.rm = T),
ResultMeasure_MeasureUnitCode_NO3 = first(ResultMeasure_MeasureUnitCode_NO3)
)
data_select_PO4 <- data_PO4 %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_PO4 = CharacteristicName,
USGSPCode_PO4 = USGSPCode,
ResultMeasureValue_PO4 = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_PO4 = ResultMeasure.MeasureUnitCode)
data_select_PO4 <- data_select_PO4 %>%
group_by(ActivityStartDate, MonitoringLocationIdentifier) %>%
summarize(CharacteristicName_PO4 = first(CharacteristicName_PO4),
USGSPCode_PO4 = first(USGSPCode_PO4),
ResultMeasureValue_PO4 = mean(ResultMeasureValue_PO4, na.rm = T),
ResultMeasure_MeasureUnitCode_PO4 = first(ResultMeasure_MeasureUnitCode_PO4)
)
data_NO3_PO4 <- data_select_NO3 %>%
full_join(data_select_PO4)
site_info_select <- sites_NO3 %>%
bind_rows(sites_PO4) %>%
distinct()
site_info_select <- site_info_select %>%
select(MonitoringLocationIdentifier,
MonitoringLocationName,
HUCEightDigitCode,
ResolvedMonitoringLocationTypeName,
StateName,
CountyName,
lat,
lon) %>%
distinct()
data_NO3_PO4 <- data_NO3_PO4 %>%
left_join(site_info_select)
write_csv(x = data_NO3_PO4, file = "./data_NO3_PO4.csv")
data_NO3_PO4 %>%
ggplot(aes(x = ResultMeasureValue_PO4, y = ResultMeasureValue_NO3)) +
geom_point()
site_summary <- data_NO3_PO4 %>%
group_by(MonitoringLocationIdentifier) %>%
summarize(n_samples = n())
site_summary <- data_NO3_PO4 %>%
group_by(MonitoringLocationIdentifier) %>%
summarize(n_samples = n())
sites2plot <- site_summary %>%
filter(n_samples >= 20)
sites2plot <- site_summary %>%
filter(n_samples >= 50)
sites2plot <- site_summary %>%
filter(n_samples >= 25)
data_NO3_PO4 %>%
filter(MonitoringLocationIdentifier %in% sites2plot$MonitoringLocationIdentifier) %>%
ggplot(aes(x = ActivityStartDate, y = ResultMeasureValue_NO3, group = MonitoringLocationIdentifier)) +
geom_point() +
geom_line() +
facet_wrap(~MonitoringLocationIdentifier)
data_NO3_PO4 %>%
filter(MonitoringLocationIdentifier %in% sites2plot$MonitoringLocationIdentifier) %>%
ggplot(aes(x = ActivityStartDate, y = ResultMeasureValue_NO3, group = MonitoringLocationIdentifier)) +
geom_point() +
geom_line() +
facet_wrap(~MonitoringLocationIdentifier, scales =  "free_x")
library(tidyverse)
precip_data <- read_csv("https://stahlm.github.io/ENS_215/Data/NOAA_State_Precip_LabData.csv")
ny_precip <- filter(precip_data, state_cd == "NY")
# Your code here
ny_precip <- ny_precip %>%
mutate(time_period = if_else(Year >= 1950,"Post-1950","Pre-1950"))
quantile(ny_precip$Precip_inches, probs = c(0.05, 0.25, 0.50, 0.75, 0.95))
View(precip_data)
precip_data <- precip_data %>%
mutate(time_period = if_else(Year >= 1950,"Post-1950","Pre-1950"))
precip_data %>% filter(state_cd %in% c("NY", "FL", "CA", "NC"))
precip_data %>% filter(state_cd %in% c("NY", "FL", "CA", "NC")) %>% ggplot(aes(x = state_cd, y = Precip_inches, fill = time_period)) + geom_boxplot()
precip_data %>% filter(state_cd %in% c("NY", "FL", "CA", "MA")) %>% ggplot(aes(x = state_cd, y = Precip_inches, fill = time_period)) + geom_boxplot()
precip_data %>% filter(state_cd %in% c("NY", "FL", "CA", "MA")) %>% ggplot(aes(x = state_cd, y = Precip_inches, fill = time_period)) + geom_boxplot() + facet_wrap(~Month)
a <- precip_data %>% group_by(state_cd, time_period) %>% summarize(precip_mean = mean(Precip_inches))
View(a)
b <- a %>% pivot_wider(names_from = time_period, values_from = precip_mean)
View(b)
a %>% ggplot(aes(x = precip_mean, y = state_cd, fill = time_period)) + geom_point()
a %>% ggplot(aes(x = precip_mean, y = reorder(state_cd, precip_mean, FUN = mean), fill = time_period)) + geom_point(shape = 21)
