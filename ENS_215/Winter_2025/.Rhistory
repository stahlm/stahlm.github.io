library(leaflet)
library(sf)
library(tmap)
library(dataRetrieval)
pCode <- c("00940")
sites_Cl <- whatWQPdata(stateCd = "CT",
parameterCd = pCode,
startDate = "2015-01-01"
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Stream"))
View(sites_Cl)
data_Cl <- readWQPqw(siteNumbers = sites_Cl$MonitoringLocationIdentifier,
parameterCd = pCode,
startDate = "2015-01-01"
)
View(data_Cl)
pCode <- c("00930")
sites_Na <- whatWQPdata(stateCd = "CT",
parameterCd = pCode,
startDate = "2015-01-01"
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Stream"))
data_Na <- readWQPqw(siteNumbers = sites_Na$MonitoringLocationIdentifier,
parameterCd = pCode,
startDate = "2015-01-01"
)
View(data_Na)
data_select_Cl <- data_Cl %>%
select(ActivityStartDate, CharacteristicName, ResultMeasureValue, ResultMeasure.MeasureUnitCode)
View(data_select_Cl)
data_select_Cl <- data_Cl %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName, USGSPCode,
ResultMeasureValue, ResultMeasure.MeasureUnitCode)
data_select_Cl <- data_Cl %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_Cl = CharacteristicName,
USGSPCode_Cl = USGSPCode,
ResultMeasureValue_Cl = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_Cl = ResultMeasure.MeasureUnitCode)
data_select_Na <- data_Na %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_Na = CharacteristicName,
USGSPCode_Na = USGSPCode,
ResultMeasureValue_Na = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_Na = ResultMeasure.MeasureUnitCode)
data_Na_Cl <- data_Na %>%
full_join(data_Cl)
data_Na_Cl <- data_select_Na %>%
full_join(data_select_Cl)
View(data_Na_Cl)
data_Na_Cl %>%
ggplot(aes(x = ResultMeasureValue_Na, y = ResultMeasureValue_Cl)) +
geom_point()
View(sites_Cl)
site_info_select <- sites_Cl %>%
bind_rows(sites_Na) %>%
distinct()
site_info_select <- site_info_select %>%
select(MonitoringLocationIdentifier,
MonitoringLocationName,
HUCEightDigitCode,
ResolvedMonitoringLocationTypeName,
StateName,
CountyName)
data_Na_Cl <- data_Na_Cl %>%
left_join(site_info_select)
View(site_info_select)
length(unique(site_info_select$MonitoringLocationIdentifier))
site_info_select <- site_info_select %>%
select(MonitoringLocationIdentifier,
MonitoringLocationName,
HUCEightDigitCode,
ResolvedMonitoringLocationTypeName,
StateName,
CountyName) %>%
duplicated()
data_Na_Cl <- data_select_Na %>%
full_join(data_select_Cl)
site_info_select <- sites_Cl %>%
bind_rows(sites_Na) %>%
distinct()
site_info_select <- site_info_select %>%
select(MonitoringLocationIdentifier,
MonitoringLocationName,
HUCEightDigitCode,
ResolvedMonitoringLocationTypeName,
StateName,
CountyName) %>%
distinct()
data_Na_Cl <- data_Na_Cl %>%
left_join(site_info_select)
View(data_Na_Cl)
site_info_select <- sites_Cl %>%
bind_rows(sites_Na) %>%
distinct()
data_Na_Cl <- data_select_Na %>%
full_join(data_select_Cl)
site_info_select <- site_info_select %>%
select(MonitoringLocationIdentifier,
MonitoringLocationName,
HUCEightDigitCode,
ResolvedMonitoringLocationTypeName,
StateName,
CountyName,
lat,
lon) %>%
distinct()
data_Na_Cl <- data_Na_Cl %>%
left_join(site_info_select)
site_summary <- data_Na_Cl %>%
group_by(MonitoringLocationIdentifier) %>%
summarize(n = n())
View(site_summary)
site_summary <- data_Na_Cl %>%
group_by(MonitoringLocationIdentifier) %>%
summarize(n_samples = n())
sites2plot <- site_summary %>%
filter(n_samples >= 10)
data_Na_Cl %>%
filter(MonitoringLocationIdentifier %in% sites2plot$MonitoringLocationIdentifier) %>%
ggplot(aes(x = ActivityStartDate, y = ResultMeasureValue_Na, group = MonitoringLocationIdentifier)) +
geom_point() +
geom_line()
data_Na_Cl %>%
filter(MonitoringLocationIdentifier %in% sites2plot$MonitoringLocationIdentifier) %>%
ggplot(aes(x = ActivityStartDate, y = ResultMeasureValue_Na, group = MonitoringLocationIdentifier)) +
geom_point() +
geom_line() +
facet_wrap(~MonitoringLocationIdentifier)
sites2plot <- site_summary %>%
filter(n_samples >= 50)
data_Na_Cl %>%
filter(MonitoringLocationIdentifier %in% sites2plot$MonitoringLocationIdentifier) %>%
ggplot(aes(x = ActivityStartDate, y = ResultMeasureValue_Na, group = MonitoringLocationIdentifier)) +
geom_point() +
geom_line() +
facet_wrap(~MonitoringLocationIdentifier)
sites2plot <- site_summary %>%
filter(n_samples >= 100)
sites2plot <- site_summary %>%
filter(n_samples >= 70)
data_Na_Cl %>%
filter(MonitoringLocationIdentifier %in% sites2plot$MonitoringLocationIdentifier) %>%
ggplot(aes(x = ActivityStartDate, y = ResultMeasureValue_Na, group = MonitoringLocationIdentifier)) +
geom_point() +
geom_line() +
facet_wrap(~MonitoringLocationIdentifier)
start_date <- "1995-01-01"
library(tidyverse)
library(lubridate)
library(leaflet)
library(sf)
library(tmap)
library(dataRetrieval)
start_date <- "1995-01-01"
pCode <- c("00940")
sites_Cl <- whatWQPdata(stateCd = "CT",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Stream"))
data_Cl <- readWQPqw(siteNumbers = sites_Cl$MonitoringLocationIdentifier,
parameterCd = pCode,
startDate = start_date
)
pCode <- c("00930")
sites_Na <- whatWQPdata(stateCd = "CT",
parameterCd = pCode,
startDate = start_date
) %>%
filter(ResolvedMonitoringLocationTypeName %in% c("Stream"))
data_Na <- readWQPqw(siteNumbers = sites_Na$MonitoringLocationIdentifier,
parameterCd = pCode,
startDate = start_date
)
data_select_Cl <- data_Cl %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_Cl = CharacteristicName,
USGSPCode_Cl = USGSPCode,
ResultMeasureValue_Cl = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_Cl = ResultMeasure.MeasureUnitCode)
data_select_Na <- data_Na %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_Na = CharacteristicName,
USGSPCode_Na = USGSPCode,
ResultMeasureValue_Na = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_Na = ResultMeasure.MeasureUnitCode)
data_Na_Cl <- data_select_Na %>%
full_join(data_select_Cl)
data_select_Cl <- data_select_Cl %>%
group_by(ActivityStartDate, MonitoringLocationIdentifier) %>%
summarize(CharacteristicName_Cl = first(CharacteristicName_Cl),
USGSPCode_Cl = first(USGSPCode_Cl),
ResultMeasureValue_Cl = mean(ResultMeasureValue_Cl, na.rm = T),
ResultMeasure_MeasureUnitCode_Cl = first(ResultMeasure_MeasureUnitCode_Cl)
)
data_select_Cl <- data_Cl %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_Cl = CharacteristicName,
USGSPCode_Cl = USGSPCode,
ResultMeasureValue_Cl = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_Cl = ResultMeasure.MeasureUnitCode)
data_select_Cl <- data_select_Cl %>%
group_by(ActivityStartDate, MonitoringLocationIdentifier) %>%
summarize(CharacteristicName_Cl = first(CharacteristicName_Cl),
USGSPCode_Cl = first(USGSPCode_Cl),
ResultMeasureValue_Cl = mean(ResultMeasureValue_Cl, na.rm = T),
ResultMeasure_MeasureUnitCode_Cl = first(ResultMeasure_MeasureUnitCode_Cl)
)
data_select_Na <- data_Na %>%
select(ActivityStartDate, MonitoringLocationIdentifier,
CharacteristicName_Na = CharacteristicName,
USGSPCode_Na = USGSPCode,
ResultMeasureValue_Na = ResultMeasureValue,
ResultMeasure_MeasureUnitCode_Na = ResultMeasure.MeasureUnitCode)
data_select_Na <- data_select_Na %>%
group_by(ActivityStartDate, MonitoringLocationIdentifier) %>%
summarize(CharacteristicName_Na = first(CharacteristicName_Na),
USGSPCode_Na = first(USGSPCode_Na),
ResultMeasureValue_Na = mean(ResultMeasureValue_Na, na.rm = T),
ResultMeasure_MeasureUnitCode_Na = first(ResultMeasure_MeasureUnitCode_Na)
)
data_Na_Cl <- data_select_Na %>%
full_join(data_select_Cl)
site_info_select <- sites_Cl %>%
bind_rows(sites_Na) %>%
distinct()
site_info_select <- site_info_select %>%
select(MonitoringLocationIdentifier,
MonitoringLocationName,
HUCEightDigitCode,
ResolvedMonitoringLocationTypeName,
StateName,
CountyName,
lat,
lon) %>%
distinct()
data_Na_Cl <- data_Na_Cl %>%
left_join(site_info_select)
write_csv(x = data_Na_Cl, file = "./data_Na_Cl.csv")
write_csv(x = data_Na_Cl, file = "./data_Na_Cl.csv")
data_Na_Cl %>%
ggplot(aes(x = ResultMeasureValue_Na, y = ResultMeasureValue_Cl)) +
geom_point()
site_summary <- data_Na_Cl %>%
group_by(MonitoringLocationIdentifier) %>%
summarize(n_samples = n())
sites2plot <- site_summary %>%
filter(n_samples >= 70)
sites2plot <- site_summary %>%
filter(n_samples >= 125)
sites2plot <- site_summary %>%
filter(n_samples >= 150)
sites2plot <- site_summary %>%
filter(n_samples >= 200)
sites2plot <- site_summary %>%
filter(n_samples >= 300)
sites2plot <- site_summary %>%
filter(n_samples >= 250)
sites2plot <- site_summary %>%
filter(n_samples >= 210)
sites2plot <- site_summary %>%
filter(n_samples >= 220)
sites2plot <- site_summary %>%
filter(n_samples >= 225)
sites2plot <- site_summary %>%
filter(n_samples >= 230)
data_Na_Cl %>%
filter(MonitoringLocationIdentifier %in% sites2plot$MonitoringLocationIdentifier) %>%
ggplot(aes(x = ActivityStartDate, y = ResultMeasureValue_Na, group = MonitoringLocationIdentifier)) +
geom_point() +
geom_line() +
facet_wrap(~MonitoringLocationIdentifier)
library(tidyverse)
library(lubridate)
library(tmap)
library(sf)
library(climateR)
library(AOI)
library(spData)
library(dygraphs)
library(xts)
raster_tc_ppt <- climateR::dap(
URL= "http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_ppt_1958_CurrentYear_GLOBE.nc",
catalog = NULL,
AOI = my_aoi,
grid = NULL,
varname = NULL,
endDate = "2023-01-01",
startDate =  "2022-05-01",
toptobottom = FALSE,
verbose = TRUE
)
my_aoi <- AOI::aoi_get(county = "Ulster", state = "NY")
raster_tc_ppt <- climateR::dap(
URL= "http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_ppt_1958_CurrentYear_GLOBE.nc",
catalog = NULL,
AOI = my_aoi,
grid = NULL,
varname = NULL,
endDate = "2023-01-01",
startDate =  "2022-05-01",
toptobottom = FALSE,
verbose = TRUE
)
terra::plot(raster_tc_ppt)
terra::plot(raster_tc_ppt$ppt)
raster_tc_ppt <- climateR::dap(
URL= "http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_ppt_1958_CurrentYear_GLOBE.nc",
catalog = NULL,
AOI = my_aoi,
grid = NULL,
varname = NULL,
endDate = "2024-05-01",
startDate =  "2023-05-01",
toptobottom = FALSE,
verbose = TRUE
)
a <- params
a <- catalog
View(a)
library(RNetCDF)
lat.range=c(-40,-44)        #! Ranges instead of point values. Order does not matter
lon.range=c(140,150)
baseurlagg <- paste0(paste0("http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_",var),"_1958_CurrentYear_GLOBE.nc")
var="ppt"
baseurlagg <- paste0(paste0("http://thredds.northwestknowledge.net:8080/thredds/dodsC/agg_terraclimate_",var),"_1958_CurrentYear_GLOBE.nc")
nc <- open.nc(baseurlagg)
lon <- var.get.nc(nc, "lon")
lat <- var.get.nc(nc, "lat")
lat.range <- sort(lat.range)                              #!sort user input values from low to high
lon.range <-sort(lon.range)
lat.index <- which(lat>=lat.range[1]&lat<=lat.range[2])    #! index values within specified range
lon.index <- which(lon>=lon.range[1]&lon<=lon.range[2])
lat.n <- length(lat.index)                                #!value for count
lon.n <- length(lon.index)
start <- c(lon.index[1], lat.index[1], 1)
count <- c(lon.n, lat.n, NA)
data <-var.get.nc(nc, variable = var,start = start, count,unpack=TRUE)
data
r_LCMAP <- getLCMAP(my_aoi, year = 2019, type = "primary landcover", ID = NULL)
terra::plot(r_LCMAP)
r_LCMAP
a <- read_live_catalog()
install.packages("tippy")
library(tippy)
library(tidyverse)
precip_data <- read_csv("https://stahlm.github.io/ENS_215/Data/NOAA_State_Precip_LabData.csv")
ny_precip <- filter(precip_data, state_cd == "NY")
# Your code here
ny_precip <- ny_precip %>%
mutate(time_period = if_else(Year >= 1950,"Post-1950","Pre-1950"))
quantile(ny_precip$Precip_inches, probs = c(0.001, 0.25, 0.50, 0.75, 0.95))
ny_precip %>%
mutate(frac = round(cume_dist(Precip_inches), 2))
#arrange(Precip_inches) %>%
#mutate(quant = (seq(1,nrow(ny_precip)) - 0.5)/nrow(ny_precip))
ny_precip %>%
mutate(frac = round(cume_dist(Precip_inches), 3))
#arrange(Precip_inches) %>%
#mutate(quant = (seq(1,nrow(ny_precip)) - 0.5)/nrow(ny_precip))
ny_precip %>%
ggplot(aes(x = state_cd, y = Precip_inches)) +
geom_boxplot(fill = "grey") +
labs(y = "Precip (inches)",
x = ""
) +
theme_classic()
ny_precip %>%
ggplot(aes(x = state_cd, y = Precip_inches)) +
geom_boxplot(fill = "grey") +
labs(y = "Precip (inches)",
x = ""
) +
theme_classic()
ny_precip %>%
ggplot(aes(x = state_cd, y = Precip_inches)) +
geom_boxplot(fill = "grey") +
geom_jitter(alpha = 0.1, width = 0.15, height = 0) +
labs(y = "Precip (inches)",
x = ""
) +
theme_classic()
ny_precip %>%
ggplot(aes(x = time_period, y = Precip_inches)) +
geom_boxplot(fill = "grey", notch = TRUE) +
labs(y = "Precip (inches)",
x = ""
) +
theme_classic()
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 )) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red") +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue") +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 ), size = 1) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red") +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue") +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 ), size = 1.5) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red") +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue") +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 ), size = 2) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red") +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue") +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
precip_data %>%
group_by(state_cd) %>%
summarize(p_25 = quantile(Precip_inches, probs = 0.25),
p_50 = median(Precip_inches),
p_75 = quantile(Precip_inches, probs = 0.75)) %>%
ggplot() +
geom_point(aes(y = reorder(state_cd, p_50), x = p_50 ), size = 2) +
geom_point(aes(y = state_cd, x = p_25), shape = 21, fill = "red", size = 2) +
geom_point(aes(y = state_cd, x = p_75), shape = 21, fill = "blue", size = 2) +
theme_classic() +
xlim(0,7) +
labs(title = "Monthly Precipition Quartiles",
subtitle = "US States",
y = "",
x = "Monthly precipitation (inches)",
caption = "25th (red), 50th (black), 75th (blue)")
library(tidyverse)
library(stats)
library(ggridges)
precip_data <- read_csv("https://stahlm.github.io/ENS_215/Data/NOAA_State_Precip_LabData.csv")
precip_data <- precip_data %>%
mutate(time_period = if_else(Year >= 1950,"Post-1950","Pre-1950"))
ny_precip <- precip_data %>%
filter(state_cd == "NY")
ny_precip %>%
ggplot(aes(Precip_inches)) +
geom_histogram() +
theme_classic()
ny_precip %>%
ggplot(aes(Precip_inches, stat(density))) +
geom_histogram() +
theme_classic()
library(tidyverse)
df_lichen <- read_csv("./air_lichen_queryFull.csv")
View(df_lichen)
df_lichen <- df_lichen %>%
mutate(across(contains(" dw")), as.numeric)
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), , as.numeric))
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric))
library(tidyverse)
df_lichen <- read_csv("./air_lichen_queryFull.csv")
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric))
View(df_lichen)
df_lichen <- read_csv("./air_lichen_queryFull.csv")
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric))
df_lichen <- read_csv("./air_lichen_queryFull.csv")
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric))
df_lichen <- df_lichen %>%
mutate(across(contains(" dw"), as.numeric)) %>%
mutate(`Distance from coast (miles)` = as.numeric(`Distance from coast (miles)`),
`Precipitation (cm/yr)` = as.numeric(`Precipitation (cm/yr)`)
)
