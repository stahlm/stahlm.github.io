---
title: "Burlington Vermont's Street Tree Diversity and Abundance"
author: "Addy Holzer"
output: 
  html_document:
    theme: simplex
    toc: yes
    toc_float:
      collapsed: true
---

## Project overveiw:
Urban forests provide numerous benefits to people. City trees provide services such as cooling local temperatures, cleaning air, storing CO2, controlling storm run off, supporting diverse local wildlife populations, as well as improving human mental health. Due to our increasing urbanization, we find ourselves with a growing need to understand ecological processes within cities in order to best support them. Climatic factors as well as human drivers such as management and cultivation influence the ---- of our urban forests. Due to these influences, the cover as well as the diversity of the street trees varies greatly throughout cities. Optimization of the numerous ecosystem services that street trees provide requires a diverse mixture of species. Higher diversity can provide a wider range of habitats for local organisms, increase pest and disease resilience, and contribute to local biodiversity protection. 

Unfortunately, many urban forests in cities around the world have been found to have a lack of biodiversity. This can have severe consequences such as limiting their ability to provide services to the urban ecosystem and local people. It also limits their resilience to pests, diseases, and climate change. These concerns have prompted steps to be taken towards improving the diversity and health of our urban forests. One such step using using guidelines for planting trees such as Frank Santamour's 10–20–30 rule. This rule of thumb recommends that cities not plant more than 10% of a single species, not more than 20% of a single genus, and not more than 30% of a family.


## Street Trees of Burlington

According to the city's parks and recreation website, the city of Burlington Vermont 

I want to study how the abundance and species diversity of street trees in Burlington Vermont relates to which and how many insects are present across the city. This is important to understand because it has been found that many cities have low levels of street tree diversity. This can negatively effect the tree’s resilience to disease and climate change as well as impacting the rest of the city’s ecosystems. Insects of the city rely on trees for habitat and food sources. Due to this connecting, abundance and diversity of insects may be a good indicator of how street trees affect other ecosystem processes that rely on them.

Scientific question:
I will investigate how differences in the density and diversity of street trees in different areas of the Burlington influence the density and diversity of different insects present in these areas. I hope to also take into account other variable that may factor into insect density and diversity such as population density of people and the area type (such as park, marketplace, residential, ect.)

```{r, echo = F, message= F}
library(tidyverse)
library(tmap)
library(sf)
library(readxl)
library(AOI)
library(tidygeocoder)
library(kableExtra)
library(moderndive)
```


```{r, echo = F, message= F}
# Load in data
Insect_data <- read_csv("./Data/Burlington_bugs.csv")
```

```{r, echo = F, message= F}
# Load in data
park_loc_df <- read_xlsx("./Data/park_loc.xlsx")
```

```{r, echo = F, message= F, warning = FALSE}
# Load in data
Street_Trees <- read_csv("./Tree_Sites_Public_View.csv")
```


```{r, echo = F, message= F}
# Select Street Tree Cols
Street_Trees <- Street_Trees %>% select(created, modified, park, add_num, add_str, growspac, landuse, site_typ, species, genus, botanic, common, diameter, height, conditn)
```

```{r, echo = F, message= F}
# Select Insect Cols
Insect_data <- Insect_data %>% select(observed_on, quality_grade, num_identification_agreements, place_guess, latitude, longitude, scientific_name, common_name)
```


```{r, echo = F, message= F}
# Create combined address column
Street_Trees <- mutate(Street_Trees, addr = paste(add_num, add_str, ", Burlington, VT"))
```

```{r, echo = F, message= T}
# Find coords for each tree from addresses
tree_coords <- geocode(.tbl = Street_Trees[1:100,], address = addr, method = 'census')
```

```{r, echo = F, message= F}
# add in park cords
tree_coords_final <-  left_join(tree_coords, park_loc_df, by = "park")
```

```{r, echo = F, message= F}
# rename cols
tree_coords_final <- tree_coords_final %>% 
  rename(Lat = lat.x, Long = long.x)
```

```{r, echo = F, message= F}
tree_coords_final <- tree_coords_final %>% 
  mutate(Lat = if_else(is.na(Lat), lat.y, Lat),
         Long = if_else(is.na(Long), long.y, Long),
         )
```

```{r, echo = F, message= F}
# delete extra lat and long cols
tree_coords_final <- tree_coords_final %>% select(-lat.y, -long.y, -add_num, -add_str)
```

```{r, echo = F, message= F}
# delete NA vals
tree_coords_final <- drop_na(tree_coords_final, Lat)
```

```{r, echo = F, message= F}
# convert to sf object
tree_coords_final_sf <- st_as_sf(tree_coords_final, coords = c("Long", "Lat"))
```

### Surveyed Street Trees
```{r, echo = F, message= F, warning=FALSE}
tmap_mode("view")

tree_coords_final_sf %>% 
  tm_shape() +
  tm_dots(fill = "springgreen4")
```

## 10/20/30 Rule
no more than 10% of any particular species, 20% of any one genus or 30% of any single family.

```{r, echo = F, message= F}
# get rid of unknown species
tree_coords_final_sf_ratios <- tree_coords_final_sf %>% 
  filter(botanic != "Unknown")
```

```{r, echo = F, message= F}
# find percentage of each genus
tree_count <- tree_coords_final_sf_ratios %>% 
  mutate(genus = tolower(genus)) %>%
  group_by(genus) %>%
  summarise(count = n()) %>%
  mutate(percent = (count / sum(count)) * 100)
```

```{r, echo = F, message= F}
# arrange in descending order
tree_count <- tree_count %>%
  arrange(desc(percent))
```

```{r, echo = F}
# genus count table
tree_count %>% select(genus, count, percent) %>%
  top_n(n = 6, count) %>%
  st_drop_geometry() %>%
  kbl() %>%
  kable_styling()
```

 
```{r, echo = F, warning = F}
# col graph of genus count
tree_count %>%
  top_n(n = 6, count) %>%
  ggplot(aes(x = reorder(genus, -count), y = count, fill = genus)) +
  geom_col() +
  labs(title = "Top 6 Street Tree Genera", 
       y = "Count",
       x = "",
       caption = "Data source: Data Hub, City of Burlington") +
  guides(fill = FALSE)  +
  theme_classic()
```


Based on the street tree data we can see that in the city of Burlington, the genus Acer, commonly known as maple, makes up about 28% of the population. The results show that maple trees make up more than the recommended proportion of this urban forest while all other genera fall within the bounds of the 10/20/30 rule.  
 
 
### Ratios of species
```{r, echo = F, message= F}
# take first 2 words
tree_coords_final_sf_ratios <- tree_coords_final_sf_ratios %>% mutate(Species = word(botanic, 1, 2))
```

```{r, echo = F, message= F}
# find percentage of each species
tree_count_species <- tree_coords_final_sf_ratios %>% 
  mutate(Species = tolower(Species)) %>%
  group_by(Species) %>%
  summarise(count = n()) %>%
  mutate(percent = (count / sum(count)) * 100)
```

```{r, echo = F, message= F}
# put in order
tree_count_species <- tree_count_species %>%
  arrange(desc(percent))
```

```{r, echo = F, message= F}
# rename acer x (cut off due to taking the first two words)
tree_count_species$Species <- ifelse(tree_count_species$Species == "acer x", 
                                           "acer x freemanii", 
                                           tree_count_species$Species)
```


```{r, echo = F}
# species count table
tree_count_species %>%
  top_n(n = 6, count) %>%
  st_drop_geometry() %>%
  kbl() %>%
  kable_styling()
```

```{r, echo = F}
# species count graph
tree_count_species %>%
  top_n(n = 6, count) %>%
  ggplot(aes(x = reorder(Species, -count), y = count, fill = Species)) +
  geom_col() +
  labs(title = "Top 6 Street Tree Genera", 
       y = "Count",
       x = "",
       caption = "Data source: Data Hub, City of Burlington") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 50, hjust = 1)) +
  guides(fill = FALSE)
```


The species with the highest proportion of the total is Fraxinus pennsylvanica, commonly known as Green Ash, making up almost 9% of the urban forest population. This is the highest percentage of any species and falls within the bounds of the 10/20/30 rule for species meaning that, based on our data, all species in Burlington make up less that 10 % of the total. 

Based on a survey of 108 cities worldwide, it has been found that on average 20% of trees in an urban forest were of the same species, 26% were of the same genus, and 32% were of the same family. Comparing the results of Burlington Vermont to these values it appears that Burlington is generally doing well with it's urban forest diverity, especially at a species level.



```{r, echo = F, message= F}
# convert to shape file
Insect_data_sf <- st_as_sf(Insect_data, coords = c("longitude", "latitude"))
```

### Reported Insects
```{r, echo = F, message= F, warning=FALSE}
# plot insects on map
tmap_mode("view")

Insect_data_sf %>% 
  tm_shape() +
  tm_dots()
```


```{r, echo = F, message= F}
library(crsuggest)
```


```{r, echo = F, message= F}
# select only species and geometry from trees
tree_minimized <- tree_coords_final_sf %>%
  select(botanic, geometry)
```

```{r, echo = F, message= F}
# select only species and geometry from insects
bug_minimized <- Insect_data_sf %>%
  select(scientific_name, geometry)
```

```{r, echo = F, message= F}
# create combined list of trees and insects
combined_list <- tree_minimized %>%
  bind_rows(bug_minimized)
```


```{r, echo = F, message= F}
# get coordinate reference
combined_list <- st_set_crs(combined_list, "EPSG:4326")
```

```{r, echo = F, message= F}
combined_sf_projected <- st_transform(combined_list, 
                             crs = "+proj=tmerc +lat_0=0 +lon_0=111 +k=1 +x_0=19500000 +y_0=0 +ellps=krass +units=m +no_defs") 
                               
```

```{r, echo = F, message= F}
# create template map
raster_template = terra::rast(terra::ext(combined_sf_projected), 
                       resolution = 500, # in meters
                       crs = terra::crs(combined_sf_projected))
```


```{r, echo = F, message= F}
# get coordinate reference
Insect_data_sf <- st_set_crs(Insect_data_sf, "EPSG:4326")
```

```{r, echo = F, message= F}
sf_projected_bugs <- st_transform(Insect_data_sf, 
                             crs = "+proj=tmerc +lat_0=0 +lon_0=111 +k=1 +x_0=19500000 +y_0=0 +ellps=krass +units=m +no_defs") 
                               
```

```{r, echo = F, message= F}
# create insect count
sf_projected_bugs <- sf_projected_bugs %>% 
  mutate(bug_count = 1)
```

```{r, echo = F, message= F}
# rasterize data
Insect_raster <- terra::rasterize(sf_projected_bugs, raster_template, field = "bug_count", fun = sum, na.rm = T)
```


```{r, echo = F}
# plot insect density on map
Insect_raster %>% 
  tm_shape() +
  tm_raster(col.scale = tm_scale_continuous())
```


### create tree grid
```{r, echo = F, message= F}
# get coordinate reference
tree_coords_final_sf <- st_set_crs(tree_coords_final_sf, "EPSG:4326")
```

```{r, echo = F, message= F}
sf_projected_trees <- st_transform(tree_coords_final_sf, 
                             crs = "+proj=tmerc +lat_0=0 +lon_0=111 +k=1 +x_0=19500000 +y_0=0 +ellps=krass +units=m +no_defs") 
                               
```


```{r, echo = F, message= F}
# create tree counts
sf_projected_trees <- sf_projected_trees %>% 
  mutate(Tree_count = 1)
```


```{r, echo = F, message= F}
# rasterize data
tree_raster <- terra::rasterize(sf_projected_trees, raster_template, field = "Tree_count", fun = sum, na.rm = T)
```


```{r, echo = F, message= F}
#plot trees on map
tree_raster %>% 
  tm_shape() +
  tm_raster(col.scale = tm_scale_continuous())
```

```{r, echo = F, message= F}
# stack tree and insect raster data
raster_stacked <- c(tree_raster, Insect_raster)
```

```{r, include = FALSE}
# convert to data frame
raster_df <- as.data.frame(raster_stacked)
raster_df
```


```{r, include = FALSE}
# name tree column
colnames(raster_df)[which(colnames(raster_df) == "sum")[2]] <- "trees"
```


```{r, include = FALSE}
# name insect column
raster_df <- raster_df %>% rename(insects = sum)
```

```{r, echo = F, message= F}
# graph insect density vs tree density
raster_df %>%
  na.omit() %>%
  ggplot(aes(x = trees, y = insects)) +
  geom_point() +
  geom_smooth(method = "lm") +
  theme_classic() +
   labs(title = "Density of Trees vs. Density of Insects", 
       y = "Insects per Plot",
       x = "Trees per Plot",
       caption = "y = 129.8877 + 0.1692 * Trees") 
```

```{r, include = FALSE}
lm_trees <- lm(data = raster_df, formula = insects ~ trees)
lm_trees
```

```{r, echo = F, message= F}
# get regression statistics
get_regression_table(lm_trees, digits = 3) %>%
  kbl() %>%
  kable_styling()
```

```{r, echo = F, message= F}
# get regression statistics
get_regression_summaries(lm_trees)%>%
  kbl() %>%
  kable_styling()
```

This data does not suggest there there is a correlation between the number of trees in an area and the number of insects reported in the area. We can see this through multiple statistics. The confidence interval of the slope includes the value of zero, meaning there is a chance that the number of trees has no impact on the number of bugs in the area. The R squared value is 0.022 which means that only 2% of the variation is explained by this model. This is a very low value and shows that there is a higher amount of non-systematic variation.

Here's the issues with this:----
Wonder if it would be different with different data sets.

## Sources:
### Data
https://data.burlingtonvt.gov/datasets/tree-sites-public-view/explore?showTable=true
https://www.inaturalist.org/observations?d1=2011-02-01&d2=2025-02-04&iconic_taxa=Insecta&place_id=50939&view=species

### Info
https://www.sciencedirect.com/science/article/pii/S1618866715001557
https://esajournals.onlinelibrary.wiley.com/doi/full/10.1002/ecs2.2105
https://datadryad.org/dataset/doi:10.5061/dryad.2jm63xsrf
