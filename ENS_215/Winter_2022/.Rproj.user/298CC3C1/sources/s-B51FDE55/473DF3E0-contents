---
title: 'Lab: Getting Started in R and EPA Fuel Efficiency Data'
author: "Ethan Oswald"
date: '2021-01-11'
output:
  html_document:
    toc: yes
    df_print: paged
  #html_notebook:
    theme: spacelab
---

## Step 1: Analysis of fuel efficiency in automobiles
### Fuel Economy Analysis

```{r}
library(tidyverse)
fuel_data <- mpg # assigning mpg to a new object 
```


```{r}
str(fuel_data) #Display the structure of fuel_data
```
Q: "How many variables are there?"
11
Q: "How many observations?"
234
Q: "What does chr, int, and num mean in the output?"
Those terms indicate data type, where chr is characters, int is a whole number, and num are floating point integers. 

```{r}
head(fuel_data) #display the first six rows of fuel data
```

Q: "What do the disp, cyl and cty columns represent?

|terms|meaning|
|:----:|:---:|
|disp|engine displacement, in litres|
|cyl|number of cylinders|
|cty|city miles per gallon|

Q: "What website was the data obtained from?"

 <https://fueleconomy.gov>
 
Find the dimensions of the fuel_data data frame
```{r}
n_rows <- nrow(fuel_data) #Number of rows in fuel_data
ncols <- ncol(fuel_data)  #Number of rows in fuel_data
```

Use the `summary()` function to get summary statistics 
```{r}
summary(fuel_data)
```
Q: "For highway driving, how many miles per gallon does the most fuel efficient vehicle get?"  
*44.00 mpg*

Q: "For highway driving, how many miles per gallon does the least fuel efficient vehicle get?"  
*12.00 mpg*

Q: "What is the average miles per gallon for city driving?"  
*17.00*

Use `mutate()` to create a new variable, hwy2cty to store the ratio of hwy to cty fuel economy
```{r}
fuel_data <- mutate(fuel_data, hwy2cty = hwy/cty)
summary(fuel_data)
```
Q: "Is there any vehicle that gets better gas mileage in the city as compared to the highway?"  
*Since all the ratios equate to greater than 1, every car in the data base has a greater mpg on the highway relative to the city.*

Q: "Is there any vehicle that has twice as good gas mileage on the highway relative to the city"  
*No car has gas double the gas mileage on the highway relative to the city gas mileage.*

Q: "What is the largest ration between highway and city gas mileage"  
*The largest calculated ratio was found to be 1.667*

#### Examining factors influencing fuel economy: Displacement  
Use ggplot to create a scatter plot of hwy vs displ  
```{r}
ggplot(data = fuel_data) + geom_point(aes(x= displ, y= hwy ))
```

Q: "How does displacement influence the fuel economy?"  
*As displacement increases, highway fuel economy decreases.*

Q: "Do any points appear to be outliers from the observed relationship? Any thoughts on what might explain these outliers?"  
*There are anomalies in the data where larger displacement engines have a much higher fuel economy than lower displacement engines. These outliers might be vehicles of different sizes/aerodynamics or of varying engine types, but this plot does not contain enough information.*

#### Examining factors influencing fuel economy: Displacement and vehicle class
```{r}
ggplot(data=fuel_data) + geom_point(aes(x = displ , y = class , color = hwy))
```

Q: "What new information did this provide us with? Can we say more about factors affecting fuel economy? Can we explain some of the outliers?"  
*This plot adds a new dimension to the analysis. We now have the class of vehicle on the y-axis to provide more information about the size of the vehicle and it's corresponding displacement. Additionally, each point is plot and colored to indicate the highway fuel efficiency. The graph now provides contextual information that contribute to fuel economy. In the United States, vehicle class is a function of total interior capacity which has an influence on MPG as seen in the plot above due to factors such as vehicle weight and size. In the figure above, the outliers can be observed in the 2seater variable, where the high displacement engines get relatively high MPG due to the low vehicle weight and size in the 2seater class. *

Add a new variable to fuel_data
```{r}
us_makes <- c("chevrolet","dodge","ford","jeep",
              "lincoln","mercury","pontiac") # list of U.S. manufacturers

fuel_data <- mutate(fuel_data, region = if_else(manufacturer %in% us_makes,"US","Foreign") )
summary(fuel_data)
```
Q: "What is the variable region telling us?"  
*It's a character data type value that indicates whether the vehicle is manufactured in the US or Foreign.*

Q: "Can you briefly explain the logic and steps taken to create the variable region"    
*The logic carried out to create the region variable starts with establishing a list of US manufacturers. This list of manufactures is then compared to the exiting manufacturer col, and if the value in the manufacture column, US is specified in region column, else, Foreign is specified in region column.*
*This is implemented in R using the `if_else()` function to do the logical comparison along with `%in%` to check if the manufacture is in the us_makes list.*


## Additional analysis

Plot year against highway mpg
```{r}
ggplot(data = fuel_data) + geom_point(aes(x= year, y= hwy , color = region ))
```

```{r}
ggplot(data = fuel_data) + geom_boxplot(aes(x = trans, y = hwy)) +
  geom_jitter(aes(x= trans, y= hwy ),alpha = 0.2, width = 0.2) 
  
```

```{r}
ggplot(data=fuel_data) + geom_point(aes(x = displ , y = hwy , color = region))
```

### Expaned EPA fuel efficiency datasheet
```{r}
vehicles <- read.csv("https://www.fueleconomy.gov/feg/epadata/vehicles.csv")
#summary(vehicles)
```
```{r}
ggplot(data = vehicles) + geom_point(aes(x= year, y= highway08, color = fuelType1))
```

```{r}
gt_50 <- filter(vehicles, highway08 >= 50) # new data frame 
```

```{r}
ggplot(data = gt_50) + geom_point(aes(x = year, y = highway08, color = fuelType1),alpha = 0.4)
```

```{r}
vehicles %>% 
  select(make,model,fuelType1,highway08,year) %>% 
  filter(fuelType1 == "Regular Gasoline") %>% 
  top_n(10, highway08) %>% 
  arrange(desc(highway08))
```

```{r}
vehicles %>% 
  select(make,model,fuelType1,highway08,year) %>% 
  filter(fuelType1 == "Electricity") %>% 
  top_n(10, highway08) %>% 
  arrange(desc(highway08))
```


