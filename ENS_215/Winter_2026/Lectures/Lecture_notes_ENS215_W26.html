<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Mason Stahl">

<title>Winter 2026: Lecture Notes ENS-215</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="Lecture_notes_ENS215_W26_files/libs/clipboard/clipboard.min.js"></script>
<script src="Lecture_notes_ENS215_W26_files/libs/quarto-html/quarto.js"></script>
<script src="Lecture_notes_ENS215_W26_files/libs/quarto-html/popper.min.js"></script>
<script src="Lecture_notes_ENS215_W26_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Lecture_notes_ENS215_W26_files/libs/quarto-html/anchor.min.js"></script>
<link href="Lecture_notes_ENS215_W26_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Lecture_notes_ENS215_W26_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="Lecture_notes_ENS215_W26_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="Lecture_notes_ENS215_W26_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Lecture_notes_ENS215_W26_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Lecture_notes_ENS215_W26_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="Lecture_notes_ENS215_W26_files/libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-full">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#lectures" id="toc-lectures" class="nav-link active" data-scroll-target="#lectures">Lectures</a>
  <ul class="collapse">
  <li><a href="#course-introduction" id="toc-course-introduction" class="nav-link" data-scroll-target="#course-introduction">Course introduction</a></li>
  <li><a href="#diving-into-r" id="toc-diving-into-r" class="nav-link" data-scroll-target="#diving-into-r">Diving into R</a></li>
  <li><a href="#r-programming-and-markdown-basics" id="toc-r-programming-and-markdown-basics" class="nav-link" data-scroll-target="#r-programming-and-markdown-basics">R Programming and Markdown Basics</a></li>
  <li><a href="#relational-and-logical-operators-ifelseelse-if" id="toc-relational-and-logical-operators-ifelseelse-if" class="nav-link" data-scroll-target="#relational-and-logical-operators-ifelseelse-if">Relational and logical operators, if/else/else if</a></li>
  <li><a href="#loops-for-while" id="toc-loops-for-while" class="nav-link" data-scroll-target="#loops-for-while">Loops (for, while)</a></li>
  <li><a href="#data-wrangling-intro" id="toc-data-wrangling-intro" class="nav-link" data-scroll-target="#data-wrangling-intro">Data wrangling (intro)</a></li>
  <li><a href="#data-wrangling-continued" id="toc-data-wrangling-continued" class="nav-link" data-scroll-target="#data-wrangling-continued">Data wrangling (continued)</a></li>
  <li><a href="#group_by-and-summarize" id="toc-group_by-and-summarize" class="nav-link" data-scroll-target="#group_by-and-summarize">group_by() and summarize()</a></li>
  <li><a href="#data-visualization-additional-topics" id="toc-data-visualization-additional-topics" class="nav-link" data-scroll-target="#data-visualization-additional-topics">Data Visualization: additional topics</a></li>
  <li><a href="#data-visualization-presentation-quality-graphics" id="toc-data-visualization-presentation-quality-graphics" class="nav-link" data-scroll-target="#data-visualization-presentation-quality-graphics">Data Visualization: Presentation quality graphics</a></li>
  <li><a href="#reshaping-cleaning-and-tidying-data" id="toc-reshaping-cleaning-and-tidying-data" class="nav-link" data-scroll-target="#reshaping-cleaning-and-tidying-data">Reshaping, cleaning and tidying data</a></li>
  <li><a href="#combiningjoining-data" id="toc-combiningjoining-data" class="nav-link" data-scroll-target="#combiningjoining-data">Combining/joining data</a></li>
  <li><a href="#making-maps" id="toc-making-maps" class="nav-link" data-scroll-target="#making-maps">Making maps</a></li>
  <li><a href="#making-maps-additional-topics" id="toc-making-maps-additional-topics" class="nav-link" data-scroll-target="#making-maps-additional-topics">Making maps: Additional topics</a></li>
  <li><a href="#rasters" id="toc-rasters" class="nav-link" data-scroll-target="#rasters">Rasters</a></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content column-page-left" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Winter 2026: Lecture Notes ENS-215</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><em>Mason Stahl</em> </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<p>Outlines below highlight some key topics to cover prior to beginning with the coding/analysis portion of the day’s lecture.<br>
<br></p>
<section id="lectures" class="level2">
<h2 class="anchored" data-anchor-id="lectures">Lectures</h2>
<section id="course-introduction" class="level3">
<h3 class="anchored" data-anchor-id="course-introduction">Course introduction</h3>
<ul>
<li>Go over syllabus and course logistics</li>
<li>Class survey</li>
<li>ESPE Winter Speaker Series dates</li>
<li>Present in-class examples to highlight what you can do with R</li>
<li>Have students set up a directory (folder) for the class, as well as sub-directories for “Lectures”, “Labs”, and “Final_project”</li>
<li>Install R and RStudio</li>
</ul>
<p>The theme of the series this year is “The Critical Ocean”.</p>
<p>All talks are on Wednesday’s from 6:00 - 7:00 PM in the Nott.</p>
<p>January 28th: Hali Kilbourne (University of Maryland) (waiting for the title, but the topic is about changing ocean currents (specifically the AMOC and its effect on climate)</p>
<p>February 4th: Julie Huber (WHOI): The Deep-Sea Around Us: The Urgent Need to Bring the Seafloor into Sight (about deep sea mining and carbon sequestration, the influence of deep sea ecosystems on global biogeochemical cycles)</p>
<p>February 18th: Sujata Murty (UAlbany) Unlocking Climate Secrets from Corals in a Time of Rapid Changes</p>
</section>
<section id="diving-into-r" class="level3">
<h3 class="anchored" data-anchor-id="diving-into-r">Diving into R</h3>
<ul>
<li>Go over RStudio/R basics, panes in R studio (begin with slides)</li>
<li>Have students set up folder for this course and create a “lectures” project<br>
</li>
<li>Describe what a function is</li>
<li>Help them open a new R Notebook and save the notebook to the appropriate folder prior to getting started with the lesson</li>
<li>Work through the first few lines of code together and view the <code>met_data</code> data frame together.<br>
</li>
<li>Once students have viewed the data frame, have a “think-pair-share” where they discuss (1) what the data consists of, (2) potential issues with the data, (3) any additional info they might need in order to interpret the data, (4) consider how the data may have been collected/measured and what potential issues/considerations that might raise.</li>
<li>Remind students to always keep an eye out for questionable/incorrect data.</li>
</ul>
</section>
<section id="r-programming-and-markdown-basics" class="level3">
<h3 class="anchored" data-anchor-id="r-programming-and-markdown-basics">R Programming and Markdown Basics</h3>
<ul>
<li>Refresh students on the RStudio/R basics, console in R, R studio panes</li>
<li>Remind students to clear their environment and hit Session -&gt; Restart R and clear all output prior to beginning for the day</li>
<li>Remind students that code should be run from top to bottom.<br>
</li>
<li>Highlight to students how you “knit” documents and point out the difference between an “.qmd” and “.html” file<br>
</li>
<li>Go over the basic data types and data structures. Emphasize the importance of properly structuring/organizing data (highlight that we will cover this topic in much greater detail in coming lectures)</li>
</ul>
</section>
<section id="relational-and-logical-operators-ifelseelse-if" class="level3">
<h3 class="anchored" data-anchor-id="relational-and-logical-operators-ifelseelse-if">Relational and logical operators, if/else/else if</h3>
<ul>
<li>Go over exercises at the end of the previous lecture<br>
</li>
<li>Functions and objects (functions have parenthesis around their arguments, index objects with brackets)</li>
<li>Go over indexing of data objects (e.g., data frames, lists, vectors,…)</li>
<li>Relational operators (equal to, less than, greater than,…)</li>
<li>Logical operators (and, or, not) and combinations of logical operators</li>
<li>if/else statements</li>
</ul>
</section>
<section id="loops-for-while" class="level3">
<h3 class="anchored" data-anchor-id="loops-for-while">Loops (for, while)</h3>
<ul>
<li>Go over exercises from last lecture. In particular focus on how to index data frames based on data criteria<br>
</li>
<li>Overview of looping. Discuss the structure of loops and the looping variable<br>
</li>
<li>Overview of counter variables</li>
<li>In the middle of class it is useful to go over the loop that prints the days in each month</li>
</ul>
</section>
<section id="data-wrangling-intro" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling-intro">Data wrangling (intro)</h3>
<ul>
<li>Remind class about the need for discussion in their lab reports<br>
</li>
<li>When writing text in Rmd after a figure you should put in two line breaks. This prevent the text from wrapping around the side of the figure<br>
</li>
<li>Remind class to include <code>embed-resources: true</code> in the YAML header</li>
<li>Go over <code>filter()</code> and piping<br>
</li>
<li>Give an example of why <code>filter(Country == "China", Country == "Spain")</code> would not return any rows</li>
</ul>
</section>
<section id="data-wrangling-continued" class="level3">
<h3 class="anchored" data-anchor-id="data-wrangling-continued">Data wrangling (continued)</h3>
<ul>
<li>HW reminder<br>
</li>
<li>Go over the exercises from last class<br>
</li>
<li>Review dplyr verbs we’ve learned thus far <code>filter()</code>, <code>arrange()</code>, <code>select()</code> and also piping <code>%&gt;%</code><br>
</li>
<li>Introduce new verbs <code>mutate()</code>, <code>rename()</code>, <code>top_n()</code>, <code>summarize()</code><br>
</li>
<li>Introduce <code>if_else()</code> and <code>case_when()</code> which are very useful with <code>mutate()</code><br>
</li>
<li>Remind class that when you apply a function it will only permanently alter the data frame if you overwrite the original object (i.e., use the <code>&lt;-</code> operator to save the object)</li>
</ul>
</section>
<section id="group_by-and-summarize" class="level3">
<h3 class="anchored" data-anchor-id="group_by-and-summarize">group_by() and summarize()</h3>
<ul>
<li><p>Revisit the looping challenge from the end of the lecture on (2025-01-15) and demonstrate how easy this same analysis is using <code>group_by()</code> and <code>summarize()</code><br>
</p></li>
<li><p>Review all of the “verbs” in dplyr that we have seen thus far. Have the gapminder data frame open in viewer, pose questions to students about each verb, and then in my console carry out an example with that verb (saving output to a new df) and examine the new df to highlight the steps we’ve taken.</p></li>
<li><p><strong>FIX:</strong> <code>summarize_at()</code> has been replaced with a newer implementation, which is <code>summarize()</code> with the <code>across()</code> function nested within. Update this lecture and update the line telling students to refer the the dplyr cheatsheet, which no longer shows <code>summarize_at()</code>.</p></li>
</ul>
<p><br></p>
</section>
<section id="data-visualization-additional-topics" class="level3">
<h3 class="anchored" data-anchor-id="data-visualization-additional-topics">Data Visualization: additional topics</h3>
<ul>
<li>Review exercises from last class</li>
<li>Check with class if anyone tried anything interesting with respect to geoms (i.e., exercise 4 from prior lecture)<br>
</li>
<li>Group aesthetic in figures</li>
<li>Reordering axes with categorical variables</li>
<li>geom_smooth(), explanation/discussion</li>
<li>Faceting</li>
<li>After ~25 min review today’s faceting challenge with the class<br>
</li>
<li><strong>FIX:</strong> On the reordered scatter plot example, I suggest students switch the x-y axes. However they have not yet learned to rotate axis text and thus the figure is not readable with the countries on the x-axis.</li>
</ul>
</section>
<section id="data-visualization-presentation-quality-graphics" class="level3">
<h3 class="anchored" data-anchor-id="data-visualization-presentation-quality-graphics">Data Visualization: Presentation quality graphics</h3>
<ul>
<li>Remind students that grades are posted to Nexus site<br>
</li>
<li>Reminder that ESPE winter seminar series 1st event is on Monday (extra credit)</li>
<li>Review challenge from last class.</li>
<li>Go over a concept of 1:1 line (which was introduced last class)<br>
</li>
<li></li>
</ul>
</section>
<section id="reshaping-cleaning-and-tidying-data" class="level3">
<h3 class="anchored" data-anchor-id="reshaping-cleaning-and-tidying-data">Reshaping, cleaning and tidying data</h3>
<ul>
<li>Reminder about ESPE speaker</li>
<li>Exercises from last class</li>
<li>Tidy data overview</li>
<li>Reshaping data with <code>pivot_longer()</code> and <code>pivot_wider()</code></li>
</ul>
</section>
<section id="combiningjoining-data" class="level3">
<h3 class="anchored" data-anchor-id="combiningjoining-data">Combining/joining data</h3>
<ul>
<li>Go over <code>pivot_longer()</code> and <code>pivot_wider()</code> from last lecture</li>
<li>Go over <code>bind_rows()</code> and joins</li>
</ul>
</section>
<section id="making-maps" class="level3">
<h3 class="anchored" data-anchor-id="making-maps">Making maps</h3>
<ul>
<li>Go over exercises from last class</li>
<li>Overview of leaflet (pipe instead of +)</li>
<li>Leaflet basemaps and geometries/layers</li>
<li>Overview of tmap (conceptually similar to ggplot)</li>
<li>In tmap highlight that you need an sf object (these have a geometry column)</li>
</ul>
</section>
<section id="making-maps-additional-topics" class="level3">
<h3 class="anchored" data-anchor-id="making-maps-additional-topics">Making maps: Additional topics</h3>
<ul>
<li><strong>Note:</strong> update tmap code so that fill color in <code>tm_fill()</code> is set by argument <code>fill =</code> instead of <code>col =</code>. My tmap version is a bit old so the argument I use in my code will not match students’ code where <code>fill =</code> is required.<br>
</li>
<li><strong>Note:</strong> In the <code>tigris</code> package example I no longer need to convert the tigris data to an sf object (current version of tigris returns sf objects). I should update my code to reflect this.</li>
</ul>
</section>
<section id="rasters" class="level3">
<h3 class="anchored" data-anchor-id="rasters">Rasters</h3>
<ul>
<li>Overview of raster data (continuous, categorical), spatial resolution</li>
</ul>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>